<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Gramagem e Peso Linear</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial;
      background: #f9f9f9;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select {
      width: 120px;
      padding: 5px;
      margin-right: 10px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    button {
      margin-top: 15px;
      padding: 8px 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Gramagem e Peso Linear</h1>

    <label for="tipoCalculo">Tipo de C√°lculo:</label>
    <select id="tipoCalculo" onchange="mostrarCampos()">
      <option value="algodao">Algod√£o</option>
      <option value="linho">Linho</option>
      <option value="ambos">Ambos</option>
    </select>

    <label>Nome do Projeto:
      <input type="text" id="nomeProjeto" placeholder="Ex: Tecidos Ver√£o 2025" style="width: 300px;">
    </label>

    <!-- üîµ Algod√£o -->
    <div id="algodaoCampos">
      <h2>Algod√£o (Ne)</h2>
      <label>Fios Teia: <input type="number" id="fiosTeiaCO" value="110"></label>
      <label>Fios Trama: <input type="number" id="fiosTramaCO" value="90"></label>
      <label>Ne Teia (ex: 20 ou 26/2): <input type="text" id="neTeiaCO" value="40"></label>
      <label>Ne Trama (ex: 15 ou 30/2): <input type="text" id="neTramaCO" value="40"></label>
      <label>Encolhimento Teia (%): <input type="number" id="encTeiaCO" value="5"></label>
      <label>Encolhimento Trama (%): <input type="number" id="encTramaCO" value="3"></label>
      <label>Largura da Tela (cm): <input type="number" id="larguraCO" value="315"></label>
    </div>

    <!-- üü¢ Linho -->
    <div id="linhoCampos">
      <h2>Linho (Nm)</h2>
      <label>Fios Teia: <input type="number" id="fiosTeiaLI" value="50"></label>
      <label>Fios Trama: <input type="number" id="fiosTramaLI" value="48"></label>
      <label>Nm Teia (ex: 7 ou 26/2): <input type="text" id="nmTeiaLI" value="26"></label>
      <label>Nm Trama (ex: 6 ou 30/2): <input type="text" id="nmTramaLI" value="26"></label>
      <label>Encolhimento Teia (%): <input type="number" id="encTeiaLI" value="5"></label>
      <label>Encolhimento Trama (%): <input type="number" id="encTramaLI" value="5"></label>
      <label>Largura da Tela (cm): <input type="number" id="larguraLI" value="330"></label>
    </div>

    <label>Exportar:
      <select id="exportarTipo">
        <option value="ambos">Algod√£o e Linho</option>
        <option value="algodao">Somente Algod√£o</option>
        <option value="linho">Somente Linho</option>
      </select>
    </label>

    <button onclick="calcular()">Calcular</button>
    <button onclick="exportarPDF()">Exportar para PDF</button>

    <div class="result" id="resultado"></div>
  </div>

  <script>
    function mostrarCampos() {
      const tipo = document.getElementById("tipoCalculo").value;
      document.getElementById("algodaoCampos").style.display = (tipo === "linho") ? "none" : "block";
      document.getElementById("linhoCampos").style.display = (tipo === "algodao") ? "none" : "block";
    }
    window.onload = mostrarCampos;

    function corrigirTitulo(titulo) {
      if (titulo.includes("/")) {
        const partes = titulo.split("/");
        return parseFloat(partes[0]) / parseFloat(partes[1]);
      }
      return parseFloat(titulo);
    }

    let resultados = {};

    function calcular() {
      // Algod√£o
      const fiosTeiaCO = parseFloat(document.getElementById("fiosTeiaCO").value);
      const fiosTramaCO = parseFloat(document.getElementById("fiosTramaCO").value);
      const neTeiaCO = corrigirTitulo(document.getElementById("neTeiaCO").value);
      const neTramaCO = corrigirTitulo(document.getElementById("neTramaCO").value);
      const encTeiaCO = parseFloat(document.getElementById("encTeiaCO").value) / 100;
      const encTramaCO = parseFloat(document.getElementById("encTramaCO").value) / 100;
      const larguraCO = parseFloat(document.getElementById("larguraCO").value);

      const parteTeiaCO = ((fiosTeiaCO / 0.0254) + ((fiosTeiaCO / 0.0254) * encTeiaCO)) / (neTeiaCO / 0.59);
      const parteTramaCO = ((fiosTramaCO / 0.0254) + ((fiosTramaCO / 0.0254) * encTramaCO)) / (neTramaCO / 0.59);
      const gramagemCO = parteTeiaCO + parteTramaCO;
      const pesoLinearCO = gramagemCO * (larguraCO / 100);

      // Linho
      const fiosTeiaLI = parseFloat(document.getElementById("fiosTeiaLI").value);
      const fiosTramaLI = parseFloat(document.getElementById("fiosTramaLI").value);
      const nmTeiaLI = corrigirTitulo(document.getElementById("nmTeiaLI").value);
      const nmTramaLI = corrigirTitulo(document.getElementById("nmTramaLI").value);
      const encTeiaLI = parseFloat(document.getElementById("encTeiaLI").value) / 100;
      const encTramaLI = parseFloat(document.getElementById("encTramaLI").value) / 100;
      const larguraLI = parseFloat(document.getElementById("larguraLI").value);

      const parteTeiaLI = ((fiosTeiaLI / 0.0254) + ((fiosTeiaLI / 0.0254) * encTeiaLI)) / nmTeiaLI;
      const parteTramaLI = ((fiosTramaLI / 0.0254) + ((fiosTramaLI / 0.0254) * encTramaLI)) / nmTramaLI;
      const gramagemLI = parteTeiaLI + parteTramaLI;
      const pesoLinearLI = gramagemLI * (larguraLI / 100);

      resultados = {
        algodao: {
          gramagem: gramagemCO.toFixed(2),
          pesoLinear: pesoLinearCO.toFixed(2),
          fiosTeia: fiosTeiaCO,
          fiosTrama: fiosTramaCO,
          neTeia: neTeiaCO,
          neTrama: neTramaCO,
          encTeia: encTeiaCO * 100,
          encTrama: encTramaCO * 100,
          largura: larguraCO
        },
        linho: {
          gramagem: gramagemLI.toFixed(2),
		   pesoLinear: pesoLinearLI.toFixed(2),
          fiosTeia: fiosTeiaLI,
          fiosTrama: fiosTramaLI,
          nmTeia: nmTeiaLI,
          nmTrama: nmTramaLI,
          encTeia: encTeiaLI * 100,
          encTrama: encTramaLI * 100,
          largura: larguraLI
        }
      };

const tipoSelecionado = document.getElementById("tipoCalculo").value;
let resultadoTexto = "";

if (tipoSelecionado === "algodao" || tipoSelecionado === "ambos") {
  resultadoTexto += `Gramagem Algod√£o (CO): ${resultados.algodao.gramagem} g/m¬≤<br>`;
  resultadoTexto += `Peso Linear Algod√£o: ${resultados.algodao.pesoLinear} g/m<br><br>`;
}

if (tipoSelecionado === "linho" || tipoSelecionado === "ambos") {
  resultadoTexto += `Gramagem Linho (LI): ${resultados.linho.gramagem} g/m¬≤<br>`;
  resultadoTexto += `Peso Linear Linho: ${resultados.linho.pesoLinear} g/m`;
}

document.getElementById("resultado").innerHTML = resultadoTexto;
    }

    function exportarPDF() {
      const tipo = document.getElementById("exportarTipo").value;
      const nomeProjeto = document.getElementById("nomeProjeto").value.trim();
      const tituloProjeto = nomeProjeto !== "" ? nomeProjeto : "Projeto: C√°lculo de Gramagem e Peso Linear";

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(14);
      doc.text(tituloProjeto, 20, 20);

      const tabelas = [];

      if (tipo === "algodao" || tipo === "ambos") {
        tabelas.push({
          title: "Algod√£o (CO)",
          head: [["Fios Teia", "Fios Trama", "Ne Teia", "Ne Trama", "Enc. Teia (%)", "Enc. Trama (%)", "Largura (cm)", "Gramagem (g/m¬≤)", "Peso Linear (g/m)"]],
          body: [[
            resultados.algodao.fiosTeia,
            resultados.algodao.fiosTrama,
            resultados.algodao.neTeia,
            resultados.algodao.neTrama,
            resultados.algodao.encTeia,
            resultados.algodao.encTrama,
            resultados.algodao.largura,
            resultados.algodao.gramagem,
            resultados.algodao.pesoLinear
          ]]
        });
      }

      if (tipo === "linho" || tipo === "ambos") {
        tabelas.push({
          title: "Linho (LI)",
          head: [["Fios Teia", "Fios Trama", "Nm Teia", "Nm Trama", "Enc. Teia (%)", "Enc. Trama (%)", "Largura (cm)", "Gramagem (g/m¬≤)", "Peso Linear (g/m)"]],
          body: [[
            resultados.linho.fiosTeia,
            resultados.linho.fiosTrama,
            resultados.linho.nmTeia,
            resultados.linho.nmTrama,
            resultados.linho.encTeia,
            resultados.linho.encTrama,
            resultados.linho.largura,
            resultados.linho.gramagem,
            resultados.linho.pesoLinear
          ]]
        });
      }

      let y = 30;
      tabelas.forEach(tabela => {
        doc.text(tabela.title, 20, y);
        doc.autoTable({
          startY: y + 5,
          head: tabela.head,
          body: tabela.body,
          theme: 'grid',
          styles: { fontSize: 10 }
        });
        y = doc.lastAutoTable.finalY + 10;
      });

      doc.save("calculo_gramagem_peso_linear.pdf");
    }
  </script>
</body>
</html>
