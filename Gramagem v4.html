<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Gramagem e Peso Linear</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial; background: #f9f9f9; padding: 20px; }
    .container { background: #fff; padding: 20px; border-radius: 8px; max-width: 800px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; }
    input, select { width: 120px; padding: 5px; margin-right: 10px; }
    .result { margin-top: 20px; font-weight: bold; font-size: 1.2em; }
    button { margin-top: 15px; padding: 8px 16px; }
    #algodaoCampos, #linhoCampos { transition: all 0.3s ease; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Gramagem e Peso Linear</h1>

    <label>Nome do Projeto: <input type="text" id="nomeProjeto" placeholder="Ex: Tecidos Verão 2025" style="width: 300px;"></label>

    <label>Tipo de Cálculo:
      <select id="exportarTipo" onchange="mostrarCampos()">
        <option value="ambos">Algodão e Linho</option>
        <option value="algodao">Somente Algodão</option>
        <option value="linho">Somente Linho</option>
      </select>
    </label><br><br>

    <div id="algodaoCampos">
      <h2>Algodão (Ne)</h2>
      <label>Fios Teia: <input type="number" id="fiosTeiaCO" value="110"></label>
      <label>Fios Trama: <input type="number" id="fiosTramaCO" value="90"></label>
      <label>Ne Teia: <input type="text" id="neTeiaCO" value="40"></label>
      <label>Ne Trama: <input type="text" id="neTramaCO" value="40"></label>
      <label>Encolhimento Teia (%): <input type="number" id="encTeiaCO" value="1"></label>
      <label>Encolhimento Trama (%): <input type="number" id="encTramaCO" value="1"></label>
      <label>Largura da Tela (cm): <input type="number" id="larguraCO" value="315"></label>
    </div>

    <div id="linhoCampos">
      <h2>Linho (Nm)</h2>
      <label>Fios Teia: <input type="number" id="fiosTeiaLI" value="50"></label>
      <label>Fios Trama: <input type="number" id="fiosTramaLI" value="48"></label>
      <label>Nm Teia: <input type="text" id="nmTeiaLI" value="26"></label>
      <label>Nm Trama: <input type="text" id="nmTramaLI" value="26"></label>
      <label>Encolhimento Teia (%): <input type="number" id="encTeiaLI" value="1"></label>
      <label>Encolhimento Trama (%): <input type="number" id="encTramaLI" value="1"></label>
      <label>Largura da Tela (cm): <input type="number" id="larguraLI" value="315"></label>
    </div>

    <button onclick="calcular()">Calcular</button>
    <button onclick="exportarPDF()">Exportar para PDF</button>

    <div class="result" id="resultado"></div>
  </div>
  <script>
  
  function mostrarCampos() {
    const tipo = document.getElementById("exportarTipo").value;
    document.getElementById("algodaoCampos").style.display = (tipo === "linho") ? "none" : "block";
    document.getElementById("linhoCampos").style.display = (tipo === "algodao") ? "none" : "block";
  }

  window.onload = mostrarCampos;

  function corrigirTitulo(titulo) {
    if (titulo.includes("/")) {
      const partes = titulo.split("/");
      return parseFloat(partes[0]) / parseFloat(partes[1]);
    }
    return parseFloat(titulo);
  }

  let resultados = {};

function calcular() {
  const tipo = document.getElementById("exportarTipo").value;
  let texto = "";

  // Função auxiliar para validar campos
  function validarCampos(ids) {
    for (let id of ids) {
      const valor = document.getElementById(id).value.trim();
      if (valor === "") return false;
    }
    return true;
  }

  const camposAlgodao = [
    "fiosTeiaCO", "fiosTramaCO", "neTeiaCO", "neTramaCO",
    "encTeiaCO", "encTramaCO", "larguraCO"
  ];
  const camposLinho = [
    "fiosTeiaLI", "fiosTramaLI", "nmTeiaLI", "nmTramaLI",
    "encTeiaLI", "encTramaLI", "larguraLI"
  ];

  if ((tipo === "algodao" || tipo === "ambos") && !validarCampos(camposAlgodao)) {
    alert("Preencha todos os campos de Algodão antes de calcular.");
    return;
  }

  if ((tipo === "linho" || tipo === "ambos") && !validarCampos(camposLinho)) {
    alert("Preencha todos os campos de Linho antes de calcular.");
    return;
  }

  // Cálculo Algodão
  if (tipo !== "linho") {
    const fiosTeiaCO = parseFloat(document.getElementById("fiosTeiaCO").value);
    const fiosTramaCO = parseFloat(document.getElementById("fiosTramaCO").value);
    const neTeiaCO = corrigirTitulo(document.getElementById("neTeiaCO").value);
    const neTramaCO = corrigirTitulo(document.getElementById("neTramaCO").value);
    const encTeiaCO = parseFloat(document.getElementById("encTeiaCO").value) / 100;
    const encTramaCO = parseFloat(document.getElementById("encTramaCO").value) / 100;
    const larguraCO = parseFloat(document.getElementById("larguraCO").value);

    const parteTeiaCO = ((fiosTeiaCO / 0.0254) + encTeiaCO) / (neTeiaCO / 0.59);
    const parteTramaCO = ((fiosTramaCO / 0.0254) + encTramaCO) / (neTramaCO / 0.59);
    const gramagemCO = parteTeiaCO + parteTramaCO;
    const pesoLinearCO = gramagemCO * (larguraCO / 100);

    resultados.algodao = {
      gramagem: gramagemCO.toFixed(2),
      pesoLinear: pesoLinearCO.toFixed(2),
      fiosTeia: fiosTeiaCO,
      fiosTrama: fiosTramaCO,
      neTeia: neTeiaCO,
      neTrama: neTramaCO,
      encTeia: encTeiaCO * 100,
      encTrama: encTramaCO * 100,
      largura: larguraCO
    };

    texto += `Gramagem Algodão (CO): ${resultados.algodao.gramagem} g/m²<br>`;
    texto += `Peso Linear Algodão: ${resultados.algodao.pesoLinear} g/m<br><br>`;
  }

  // Cálculo Linho
  if (tipo !== "algodao") {
    const fiosTeiaLI = parseFloat(document.getElementById("fiosTeiaLI").value);
    const fiosTramaLI = parseFloat(document.getElementById("fiosTramaLI").value);
    const nmTeiaLI = corrigirTitulo(document.getElementById("nmTeiaLI").value);
    const nmTramaLI = corrigirTitulo(document.getElementById("nmTramaLI").value);
    const encTeiaLI = parseFloat(document.getElementById("encTeiaLI").value) / 100;
    const encTramaLI = parseFloat(document.getElementById("encTramaLI").value) / 100;
    const larguraLI = parseFloat(document.getElementById("larguraLI").value);

    const parteTeiaLI = ((fiosTeiaLI / 0.0254) + encTeiaLI) / nmTeiaLI;
    const parteTramaLI = ((fiosTramaLI / 0.0254) + encTramaLI) / nmTramaLI;
    const gramagemLI = parteTeiaLI + parteTramaLI;
    const pesoLinearLI = gramagemLI * (larguraLI / 100);

    resultados.linho = {
      gramagem: gramagemLI.toFixed(2),
      pesoLinear: pesoLinearLI.toFixed(2),
      fiosTeia: fiosTeiaLI,
      fiosTrama: fiosTramaLI,
      nmTeia: nmTeiaLI,
      nmTrama: nmTramaLI,
      encTeia: encTeiaLI * 100,
      encTrama: encTramaLI * 100,
      largura: larguraLI
    };

    texto += `Gramagem Linho (LI): ${resultados.linho.gramagem} g/m²<br>`;
    texto += `Peso Linear Linho: ${resultados.linho.pesoLinear} g/m`;
  }

  document.getElementById("resultado").innerHTML = texto;
}

function exportarPDF() {
  const tipo = document.getElementById("exportarTipo").value;
  const nomeProjeto = document.getElementById("nomeProjeto").value.trim();

  // Se estiver vazio, usa título padrão
  const tituloProjeto = nomeProjeto !== "" ? nomeProjeto : "Projeto: Cálculo de Gramagem e Peso Linear";

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(14);
  doc.text(tituloProjeto, 20, 20);

    const tabelas = [];

    if (tipo === "algodao" || tipo === "ambos") {
      tabelas.push({
        title: "Algodão (CO)",
        head: [["Fios Teia", "Fios Trama", "Ne Teia", "Ne Trama", "Enc. Teia (%)", "Enc. Trama (%)", "Largura (cm)", "Gramagem (g/m²)", "Peso Linear (g/m)"]],
        body: [[
          resultados.algodao.fiosTeia,
          resultados.algodao.fiosTrama,
          resultados.algodao.neTeia,
          resultados.algodao.neTrama,
          resultados.algodao.encTeia,
          resultados.algodao.encTrama,
          resultados.algodao.largura,
          resultados.algodao.gramagem,
          resultados.algodao.pesoLinear
        ]]
      });
    }

    if (tipo === "linho" || tipo === "ambos") {
      tabelas.push({
        title: "Linho (LI)",
        head: [["Fios Teia", "Fios Trama", "Nm Teia", "Nm Trama", "Enc. Teia (%)", "Enc. Trama (%)", "Largura (cm)", "Gramagem (g/m²)", "Peso Linear (g/m)"]],
        body: [[
          resultados.linho.fiosTeia,
          resultados.linho.fiosTrama,
          resultados.linho.nmTeia,
          resultados.linho.nmTrama,
          resultados.linho.encTeia,
          resultados.linho.encTrama,
          resultados.linho.largura,
          resultados.linho.gramagem,
          resultados.linho.pesoLinear
        ]]
      });
    }

    let y = 30;
    tabelas.forEach(tabela => {
      doc.text(tabela.title, 20, y);
      doc.autoTable({
        startY: y + 5,
        head: tabela.head,
        body: tabela.body,
        theme: 'grid',
        styles: { fontSize: 10 }
      });
      y = doc.lastAutoTable.finalY + 10;
    });

    doc.save("calculo_gramagem_peso_linear.pdf");
  }
</script>
</body>
</html>
